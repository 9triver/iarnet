<svg xmlns="http://www.w3.org/2000/svg" width="1160" height="640" viewBox="0 0 1160 640">
  <defs>
    <style><![CDATA[
      .title{font:700 24px system-ui,Segoe UI,Roboto,Helvetica,Arial}
      .subtitle{font:600 18px system-ui,Segoe UI,Roboto,Helvetica,Arial}
      .label{font:500 14px system-ui,Segoe UI,Roboto,Helvetica,Arial}
      .mono{font:600 12px ui-monospace,Consolas,Menlo}
    ]]></style>
    <marker id="a1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 z" fill="#00897B"/>
    </marker>
    <marker id="a2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 z" fill="#5E35B1"/>
    </marker>
    <filter id="shadow"><feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.18"/></filter>
  </defs>
  <rect x="0" y="0" width="1160" height="640" fill="#F1F8E9"/>
  <text x="580" y="40" text-anchor="middle" class="title">Gossip：资源管理节点发现与状态同步</text>

  <!-- Node u -->
  <g filter="url(#shadow)">
    <rect x="120" y="120" width="360" height="200" rx="14" fill="#FFFFFF" stroke="#80CBC4"/>
  </g>
  <text x="300" y="150" text-anchor="middle" class="subtitle">节点 u（本地视图 S_u）</text>
  <text x="150" y="185" class="mono">SummaryHeader(H_u)</text>
  <text x="150" y="210" class="mono">items: [peer_id, version, digest, ttl]</text>
  <text x="150" y="235" class="mono">Delta(Δ_u): 可选节点明细</text>

  <!-- Node v -->
  <g filter="url(#shadow)">
    <rect x="680" y="120" width="360" height="200" rx="14" fill="#FFFFFF" stroke="#80CBC4"/>
  </g>
  <text x="860" y="150" text-anchor="middle" class="subtitle">节点 v（本地视图 S_v）</text>
  <text x="710" y="185" class="mono">SummaryHeader(H_v)</text>
  <text x="710" y="210" class="mono">items: [peer_id, version, digest, ttl]</text>
  <text x="710" y="235" class="mono">Delta(Δ_v): 可选节点明细</text>

  <!-- Exchange arrows -->
  <path d="M480 220 C560 200, 640 200, 680 220" stroke="#00897B" stroke-width="3" fill="none" marker-end="url(#a1)"/>
  <text x="580" y="195" class="mono" text-anchor="middle">发送 H_u + 选择性 Δ_u</text>
  <path d="M680 260 C600 280, 520 280, 480 260" stroke="#5E35B1" stroke-width="3" fill="none" marker-end="url(#a2)"/>
  <text x="580" y="295" class="mono" text-anchor="middle">返回 H_v + 选择性 Δ_v</text>

  <!-- Pull stage -->
  <g>
    <rect x="240" y="360" width="680" height="70" rx="10" fill="#FFF" stroke="#B0BEC5"/>
    <text x="260" y="385" class="mono">Pull 缺失条目 → VersionedMerge(S_u, Δ_v)，TTL 衰减；必要时触发 Anti-Entropy</text>
    <text x="260" y="408" class="mono">合并策略：版本优先，时间戳兜底；status 取更严重者（down&gt;suspect&gt;healthy），资源使用取更小值避免过度分配</text>
  </g>

  <!-- Footnote -->
  <text x="580" y="610" text-anchor="middle" class="label">传播对象为“资源管理节点及其资源使用情况”，而非 Provider 实例</text>
</svg>

