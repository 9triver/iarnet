# IARNet 用户管理系统说明文档

## 目录

1. [系统概述](#系统概述)
2. [用户角色](#用户角色)
3. [权限说明](#权限说明)
4. [功能使用指南](#功能使用指南)
5. [安全机制](#安全机制)

---

## 系统概述

IARNet 用户管理系统提供了基于角色的访问控制（RBAC）功能，支持三种用户角色，每种角色具有不同的系统访问权限。系统使用 SQLite 数据库持久化存储用户信息，并提供完整的用户管理功能。

### 主要特性

- **角色权限控制**：三种角色，分级权限管理
- **用户管理**：创建、编辑、删除、解锁用户
- **密码管理**：用户可自行修改密码
- **安全机制**：登录失败锁定、验证码保护
- **数据持久化**：用户信息存储在 SQLite 数据库中

---

## 用户角色

系统定义了三种用户角色，按权限从低到高排列：

### 1. 普通用户（Normal User）

- **角色标识**：`normal`
- **显示名称**：普通用户
- **默认角色**：新创建的用户默认为此角色

### 2. 平台管理员（Platform Administrator）

- **角色标识**：`platform`
- **显示名称**：平台管理员
- **权限级别**：中等

### 3. 超级管理员（Super Administrator）

- **角色标识**：`super`
- **显示名称**：超级管理员
- **权限级别**：最高
- **特殊说明**：配置文件中定义的初始超级管理员账户受到特殊保护

---

## 权限说明

### 功能模块权限矩阵

| 功能模块 | 普通用户 | 平台管理员 | 超级管理员 |
|---------|---------|-----------|-----------|
| **资源管理** | 查看（只读） | 完整功能（增删改查） | 完整功能（增删改查） |
| **应用管理** | 完整功能 | 完整功能 | 完整功能 |
| **日志审计** | ❌ 无权限 | ✅ 可访问 | ✅ 可访问 |
| **用户管理** | ❌ 无权限 | ❌ 无权限 | ✅ 可访问 |
| **修改自身密码** | ✅ 可修改 | ✅ 可修改 | ✅ 可修改 |

### 详细权限说明

#### 资源管理模块

- **普通用户**：
  - ✅ 查看资源列表
  - ✅ 查看资源详情
  - ❌ 不能添加资源
  - ❌ 不能编辑资源
  - ❌ 不能删除资源
  - ❌ 不能批量接入资源

- **平台管理员/超级管理员**：
  - ✅ 查看资源列表
  - ✅ 查看资源详情
  - ✅ 添加资源
  - ✅ 编辑资源
  - ✅ 删除资源
  - ✅ 批量接入资源

#### 应用管理模块

所有已登录用户都可以：
- ✅ 导入应用
- ✅ 部署应用
- ✅ 查看应用列表
- ✅ 查看应用详情
- ✅ 停止应用
- ✅ 查看应用日志

#### 日志审计模块

- **普通用户**：❌ 无权限访问
- **平台管理员/超级管理员**：
  - ✅ 查看系统日志
  - ✅ 查看操作记录
  - ✅ 按时间、用户、操作类型筛选

#### 用户管理模块

- **普通用户/平台管理员**：❌ 无权限访问
- **超级管理员**：
  - ✅ 查看用户列表
  - ✅ 创建新用户
  - ✅ 编辑用户信息（角色、密码）
  - ✅ 删除用户
  - ✅ 解锁被锁定的用户
  - ⚠️ 不能删除配置的初始超级管理员账户
  - ⚠️ 不能修改其他超级管理员的密码（只能由该账户自己修改）

---

## 功能使用指南

### 1. 用户登录

#### 登录流程

1. 访问登录页面
2. 输入用户名和密码
3. 输入验证码（验证码有效期为 2 分钟）
4. 点击"登录"按钮

#### 登录安全机制

- **验证码保护**：每次登录需要输入验证码
- **登录失败锁定**：
  - 连续登录失败达到阈值后，账户将被锁定
  - 锁定期间无法登录
  - 锁定时间到期后自动解锁
  - 显示剩余重试次数和解锁时间

#### 验证码说明

- **有效期**：2 分钟（由后端控制）
- **显示**：前端显示剩余有效时间（格式：分:秒）
- **刷新**：
  - 验证码过期时自动刷新
  - 验证失败时自动刷新
  - 点击验证码图片可手动刷新
  - 点击刷新按钮可手动刷新

### 2. 修改密码

#### 操作步骤

1. 登录系统后，在左侧边栏底部找到"修改密码"按钮
2. 点击"修改密码"按钮，打开修改密码对话框
3. 输入当前密码
4. 输入新密码（至少 6 位）
5. 确认新密码
6. 点击"确认修改"按钮

#### 注意事项

- 新密码长度至少为 6 位
- 新密码和确认密码必须一致
- 修改成功后需要重新登录（如果后端要求）

### 3. 用户管理（仅超级管理员）

#### 访问用户管理

1. 以超级管理员身份登录
2. 在左侧导航栏点击"用户管理"
3. 进入用户管理页面

#### 创建用户

1. 点击"创建用户"按钮
2. 填写用户信息：
   - **用户名**：必填，唯一标识
   - **密码**：必填，至少 6 位
   - **角色**：选择用户角色（普通用户/平台管理员/超级管理员）
3. 点击"保存"按钮

#### 编辑用户

1. 在用户列表中找到要编辑的用户
2. 点击该用户行的"编辑"按钮
3. 修改用户信息：
   - **新密码**：留空则不修改，填写则更新密码
   - **角色**：可修改用户角色
4. 点击"保存"按钮

**限制**：
- 不能修改配置的初始超级管理员账户的密码（只能由该账户自己修改）
- 可以修改其他用户信息

#### 删除用户

1. 在用户列表中找到要删除的用户
2. 点击该用户行的"删除"按钮
3. 确认删除操作

**限制**：
- 不能删除配置的初始超级管理员账户
- 删除操作不可恢复

#### 解锁用户

1. 在用户列表中找到被锁定的用户（状态显示为"已锁定"）
2. 点击该用户行的"解锁"按钮
3. 用户立即解锁，可以重新登录

### 4. 初始超级管理员配置

#### 配置文件设置

在 `config.yaml` 中配置初始超级管理员：

```yaml
super_admin:
  name: "admin"        # 用户名
  password: "123456"   # 密码（明文，仅用于初始化）
```

#### 初始化流程

1. 系统启动时检查数据库是否为空
2. 如果数据库为空，自动创建配置文件中定义的超级管理员账户
3. 如果数据库已有用户，检查是否已存在该超级管理员
4. 如果不存在且数据库中没有其他超级管理员，则创建该账户

#### 特殊保护机制

初始超级管理员账户受到以下保护：

1. **不能删除**：任何超级管理员都无法删除该账户
2. **密码修改限制**：
   - 其他超级管理员不能修改该账户的密码
   - 只能由该账户自己修改密码

---

## 安全机制

### 1. 密码安全

- **传输安全**：登录时密码使用 SHA-256 哈希后传输
- **存储方式**：密码以明文形式存储在数据库中（用于验证）
- **修改密码**：修改密码时发送明文（建议使用 HTTPS）

### 2. 登录失败锁定

- **失败计数**：记录用户登录失败次数
- **锁定阈值**：达到阈值后自动锁定账户
- **锁定时间**：锁定后需要等待指定时间才能重新尝试
- **解锁方式**：
  - 等待锁定时间到期自动解锁
  - 超级管理员手动解锁

### 3. 验证码保护

- **有效期控制**：验证码有效期为 2 分钟（后端控制）
- **一次性使用**：验证成功后立即删除
- **失败重试**：验证失败时保留验证码，允许重试
- **自动刷新**：过期或失败时自动刷新

### 4. 权限控制

- **前端控制**：前端根据用户角色显示/隐藏功能按钮
- **后端验证**：后端对所有操作进行权限验证

### 5. 数据持久化

- **数据库存储**：用户信息存储在 SQLite 数据库中
- **数据目录**：数据库文件位于 `data/users.db`
- **自动初始化**：首次启动时自动创建数据库和表结构
